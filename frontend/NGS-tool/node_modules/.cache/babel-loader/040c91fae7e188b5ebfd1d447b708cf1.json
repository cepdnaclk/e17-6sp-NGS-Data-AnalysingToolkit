{"ast":null,"code":"var ElementType = require(\"domelementtype\");\n\nvar re_whitespace = /\\s+/g;\n\nvar NodePrototype = require(\"./lib/node\");\n\nvar ElementPrototype = require(\"./lib/element\");\n\nfunction DomHandler(callback, options, elementCB) {\n  if (typeof callback === \"object\") {\n    elementCB = options;\n    options = callback;\n    callback = null;\n  } else if (typeof options === \"function\") {\n    elementCB = options;\n    options = defaultOpts;\n  }\n\n  this._callback = callback;\n  this._options = options || defaultOpts;\n  this._elementCB = elementCB;\n  this.dom = [];\n  this._done = false;\n  this._tagStack = [];\n  this._parser = this._parser || null;\n} //default options\n\n\nvar defaultOpts = {\n  normalizeWhitespace: false,\n  //Replace all whitespace with single spaces\n  withStartIndices: false,\n  //Add startIndex properties to nodes\n  withEndIndices: false //Add endIndex properties to nodes\n\n};\n\nDomHandler.prototype.onparserinit = function (parser) {\n  this._parser = parser;\n}; //Resets the handler back to starting state\n\n\nDomHandler.prototype.onreset = function () {\n  DomHandler.call(this, this._callback, this._options, this._elementCB);\n}; //Signals the handler that parsing is done\n\n\nDomHandler.prototype.onend = function () {\n  if (this._done) return;\n  this._done = true;\n  this._parser = null;\n\n  this._handleCallback(null);\n};\n\nDomHandler.prototype._handleCallback = DomHandler.prototype.onerror = function (error) {\n  if (typeof this._callback === \"function\") {\n    this._callback(error, this.dom);\n  } else {\n    if (error) throw error;\n  }\n};\n\nDomHandler.prototype.onclosetag = function () {\n  //if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\n  var elem = this._tagStack.pop();\n\n  if (this._options.withEndIndices && elem) {\n    elem.endIndex = this._parser.endIndex;\n  }\n\n  if (this._elementCB) this._elementCB(elem);\n};\n\nDomHandler.prototype._createDomElement = function (properties) {\n  if (!this._options.withDomLvl1) return properties;\n  var element;\n\n  if (properties.type === \"tag\") {\n    element = Object.create(ElementPrototype);\n  } else {\n    element = Object.create(NodePrototype);\n  }\n\n  for (var key in properties) {\n    if (properties.hasOwnProperty(key)) {\n      element[key] = properties[key];\n    }\n  }\n\n  return element;\n};\n\nDomHandler.prototype._addDomElement = function (element) {\n  var parent = this._tagStack[this._tagStack.length - 1];\n  var siblings = parent ? parent.children : this.dom;\n  var previousSibling = siblings[siblings.length - 1];\n  element.next = null;\n\n  if (this._options.withStartIndices) {\n    element.startIndex = this._parser.startIndex;\n  }\n\n  if (this._options.withEndIndices) {\n    element.endIndex = this._parser.endIndex;\n  }\n\n  if (previousSibling) {\n    element.prev = previousSibling;\n    previousSibling.next = element;\n  } else {\n    element.prev = null;\n  }\n\n  siblings.push(element);\n  element.parent = parent || null;\n};\n\nDomHandler.prototype.onopentag = function (name, attribs) {\n  var properties = {\n    type: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\n    name: name,\n    attribs: attribs,\n    children: []\n  };\n\n  var element = this._createDomElement(properties);\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.ontext = function (data) {\n  //the ignoreWhitespace is officially dropped, but for now,\n  //it's an alias for normalizeWhitespace\n  var normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\n  var lastTag;\n\n  if (!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length - 1]).type === ElementType.Text) {\n    if (normalize) {\n      lastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n    } else {\n      lastTag.data += data;\n    }\n  } else {\n    if (this._tagStack.length && (lastTag = this._tagStack[this._tagStack.length - 1]) && (lastTag = lastTag.children[lastTag.children.length - 1]) && lastTag.type === ElementType.Text) {\n      if (normalize) {\n        lastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n      } else {\n        lastTag.data += data;\n      }\n    } else {\n      if (normalize) {\n        data = data.replace(re_whitespace, \" \");\n      }\n\n      var element = this._createDomElement({\n        data: data,\n        type: ElementType.Text\n      });\n\n      this._addDomElement(element);\n    }\n  }\n};\n\nDomHandler.prototype.oncomment = function (data) {\n  var lastTag = this._tagStack[this._tagStack.length - 1];\n\n  if (lastTag && lastTag.type === ElementType.Comment) {\n    lastTag.data += data;\n    return;\n  }\n\n  var properties = {\n    data: data,\n    type: ElementType.Comment\n  };\n\n  var element = this._createDomElement(properties);\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.oncdatastart = function () {\n  var properties = {\n    children: [{\n      data: \"\",\n      type: ElementType.Text\n    }],\n    type: ElementType.CDATA\n  };\n\n  var element = this._createDomElement(properties);\n\n  this._addDomElement(element);\n\n  this._tagStack.push(element);\n};\n\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function () {\n  this._tagStack.pop();\n};\n\nDomHandler.prototype.onprocessinginstruction = function (name, data) {\n  var element = this._createDomElement({\n    name: name,\n    data: data,\n    type: ElementType.Directive\n  });\n\n  this._addDomElement(element);\n};\n\nmodule.exports = DomHandler;","map":{"version":3,"sources":["C:/Users/USER/Documents/6 sem/6s-proj/e17-co328-NGS-Data-AnalysingToolkit/frontend/NGS-tool/node_modules/react-html-parser/node_modules/domhandler/index.js"],"names":["ElementType","require","re_whitespace","NodePrototype","ElementPrototype","DomHandler","callback","options","elementCB","defaultOpts","_callback","_options","_elementCB","dom","_done","_tagStack","_parser","normalizeWhitespace","withStartIndices","withEndIndices","prototype","onparserinit","parser","onreset","call","onend","_handleCallback","onerror","error","onclosetag","elem","pop","endIndex","_createDomElement","properties","withDomLvl1","element","type","Object","create","key","hasOwnProperty","_addDomElement","parent","length","siblings","children","previousSibling","next","startIndex","prev","push","onopentag","name","attribs","Script","Style","Tag","ontext","data","normalize","ignoreWhitespace","lastTag","Text","replace","oncomment","Comment","oncdatastart","CDATA","oncommentend","oncdataend","onprocessinginstruction","Directive","module","exports"],"mappings":"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","sourcesContent":["var ElementType = require(\"domelementtype\");\r\n\r\nvar re_whitespace = /\\s+/g;\r\nvar NodePrototype = require(\"./lib/node\");\r\nvar ElementPrototype = require(\"./lib/element\");\r\n\r\nfunction DomHandler(callback, options, elementCB){\r\n\tif(typeof callback === \"object\"){\r\n\t\telementCB = options;\r\n\t\toptions = callback;\r\n\t\tcallback = null;\r\n\t} else if(typeof options === \"function\"){\r\n\t\telementCB = options;\r\n\t\toptions = defaultOpts;\r\n\t}\r\n\tthis._callback = callback;\r\n\tthis._options = options || defaultOpts;\r\n\tthis._elementCB = elementCB;\r\n\tthis.dom = [];\r\n\tthis._done = false;\r\n\tthis._tagStack = [];\r\n\tthis._parser = this._parser || null;\r\n}\r\n\r\n//default options\r\nvar defaultOpts = {\r\n\tnormalizeWhitespace: false, //Replace all whitespace with single spaces\r\n\twithStartIndices: false, //Add startIndex properties to nodes\r\n\twithEndIndices: false, //Add endIndex properties to nodes\r\n};\r\n\r\nDomHandler.prototype.onparserinit = function(parser){\r\n\tthis._parser = parser;\r\n};\r\n\r\n//Resets the handler back to starting state\r\nDomHandler.prototype.onreset = function(){\r\n\tDomHandler.call(this, this._callback, this._options, this._elementCB);\r\n};\r\n\r\n//Signals the handler that parsing is done\r\nDomHandler.prototype.onend = function(){\r\n\tif(this._done) return;\r\n\tthis._done = true;\r\n\tthis._parser = null;\r\n\tthis._handleCallback(null);\r\n};\r\n\r\nDomHandler.prototype._handleCallback =\r\nDomHandler.prototype.onerror = function(error){\r\n\tif(typeof this._callback === \"function\"){\r\n\t\tthis._callback(error, this.dom);\r\n\t} else {\r\n\t\tif(error) throw error;\r\n\t}\r\n};\r\n\r\nDomHandler.prototype.onclosetag = function(){\r\n\t//if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\r\n\t\r\n\tvar elem = this._tagStack.pop();\r\n\r\n\tif(this._options.withEndIndices && elem){\r\n\t\telem.endIndex = this._parser.endIndex;\r\n\t}\r\n\r\n\tif(this._elementCB) this._elementCB(elem);\r\n};\r\n\r\nDomHandler.prototype._createDomElement = function(properties){\r\n\tif (!this._options.withDomLvl1) return properties;\r\n\r\n\tvar element;\r\n\tif (properties.type === \"tag\") {\r\n\t\telement = Object.create(ElementPrototype);\r\n\t} else {\r\n\t\telement = Object.create(NodePrototype);\r\n\t}\r\n\r\n\tfor (var key in properties) {\r\n\t\tif (properties.hasOwnProperty(key)) {\r\n\t\t\telement[key] = properties[key];\r\n\t\t}\r\n\t}\r\n\r\n\treturn element;\r\n};\r\n\r\nDomHandler.prototype._addDomElement = function(element){\r\n\tvar parent = this._tagStack[this._tagStack.length - 1];\r\n\tvar siblings = parent ? parent.children : this.dom;\r\n\tvar previousSibling = siblings[siblings.length - 1];\r\n\r\n\telement.next = null;\r\n\r\n\tif(this._options.withStartIndices){\r\n\t\telement.startIndex = this._parser.startIndex;\r\n\t}\r\n\tif(this._options.withEndIndices){\r\n\t\telement.endIndex = this._parser.endIndex;\r\n\t}\r\n\r\n\tif(previousSibling){\r\n\t\telement.prev = previousSibling;\r\n\t\tpreviousSibling.next = element;\r\n\t} else {\r\n\t\telement.prev = null;\r\n\t}\r\n\r\n\tsiblings.push(element);\r\n\telement.parent = parent || null;\r\n};\r\n\r\nDomHandler.prototype.onopentag = function(name, attribs){\r\n\tvar properties = {\r\n\t\ttype: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\r\n\t\tname: name,\r\n\t\tattribs: attribs,\r\n\t\tchildren: []\r\n\t};\r\n\r\n\tvar element = this._createDomElement(properties);\r\n\r\n\tthis._addDomElement(element);\r\n\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.ontext = function(data){\r\n\t//the ignoreWhitespace is officially dropped, but for now,\r\n\t//it's an alias for normalizeWhitespace\r\n\tvar normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\r\n\r\n\tvar lastTag;\r\n\r\n\tif(!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length-1]).type === ElementType.Text){\r\n\t\tif(normalize){\r\n\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\r\n\t\t} else {\r\n\t\t\tlastTag.data += data;\r\n\t\t}\r\n\t} else {\r\n\t\tif(\r\n\t\t\tthis._tagStack.length &&\r\n\t\t\t(lastTag = this._tagStack[this._tagStack.length - 1]) &&\r\n\t\t\t(lastTag = lastTag.children[lastTag.children.length - 1]) &&\r\n\t\t\tlastTag.type === ElementType.Text\r\n\t\t){\r\n\t\t\tif(normalize){\r\n\t\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\r\n\t\t\t} else {\r\n\t\t\t\tlastTag.data += data;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(normalize){\r\n\t\t\t\tdata = data.replace(re_whitespace, \" \");\r\n\t\t\t}\r\n\r\n\t\t\tvar element = this._createDomElement({\r\n\t\t\t\tdata: data,\r\n\t\t\t\ttype: ElementType.Text\r\n\t\t\t});\r\n\r\n\t\t\tthis._addDomElement(element);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDomHandler.prototype.oncomment = function(data){\r\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\r\n\r\n\tif(lastTag && lastTag.type === ElementType.Comment){\r\n\t\tlastTag.data += data;\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar properties = {\r\n\t\tdata: data,\r\n\t\ttype: ElementType.Comment\r\n\t};\r\n\r\n\tvar element = this._createDomElement(properties);\r\n\r\n\tthis._addDomElement(element);\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.oncdatastart = function(){\r\n\tvar properties = {\r\n\t\tchildren: [{\r\n\t\t\tdata: \"\",\r\n\t\t\ttype: ElementType.Text\r\n\t\t}],\r\n\t\ttype: ElementType.CDATA\r\n\t};\r\n\r\n\tvar element = this._createDomElement(properties);\r\n\r\n\tthis._addDomElement(element);\r\n\tthis._tagStack.push(element);\r\n};\r\n\r\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function(){\r\n\tthis._tagStack.pop();\r\n};\r\n\r\nDomHandler.prototype.onprocessinginstruction = function(name, data){\r\n\tvar element = this._createDomElement({\r\n\t\tname: name,\r\n\t\tdata: data,\r\n\t\ttype: ElementType.Directive\r\n\t});\r\n\r\n\tthis._addDomElement(element);\r\n};\r\n\r\nmodule.exports = DomHandler;\r\n"]},"metadata":{},"sourceType":"script"}